#!/bin/bash
# Dotfiles Cheat Sheet - Quick reference for all keybindings and shortcuts
# Part of dotfiles - compact display of vim, tmux, git, and shell shortcuts

set -e

# Source core functions for colors
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# Navigate up one directory since we're now in bin/
DOTFILES_DIR="$(dirname "$SCRIPT_DIR")"
source "$DOTFILES_DIR/lib.sh"

# Terminal width detection
TERM_WIDTH=$(tput cols 2>/dev/null || echo 80)

# Color definitions using tput for better compatibility
if command -v tput >/dev/null 2>&1 && [[ -t 1 ]]; then
    BOLD=$(tput bold)
    CYAN=$(tput setaf 6)
    YELLOW=$(tput setaf 3)
    DIM=$(tput dim)
    RESET=$(tput sgr0)
else
    BOLD=""
    CYAN=""
    YELLOW=""
    DIM=""
    RESET=""
fi

# Print section header
print_header() {
    local title="$1"
    echo
    echo "${BOLD}${CYAN}${title}${RESET}"
}

# Print table separator
print_separator() {
    printf "${DIM}"
    printf '‚îÄ%.0s' $(seq 1 "$TERM_WIDTH")
    printf "${RESET}\n"
}

# Format keybinding line with colors
format_line() {
    echo "$1" | sed -E "s/([^ ]+)( +)([^‚îÇ]+)/\\1\\2${DIM}\\3${RESET}/g" | \
                sed -E "s/^([^ ]+)/    ${YELLOW}\\1${RESET}/"
}

# Show vim keybindings
show_vim() {
    print_header "VIM KEYBINDINGS"
    echo "    Navigation          Git                Code               Windows"
    print_separator
    format_line "Ctrl+P  Files       ,gs  Status        ,af  Fix          Ctrl+E  Up"
    format_line ",f      Files       ,gd  Diff          ,an  Next err     Ctrl+S  Left"
    format_line ",b      Buffers     ,gb  Blame         ,ap  Prev err     Ctrl+D  Down"
    format_line ",g      Grep        ,hn  Next hunk     ,/   Comment      Ctrl+F  Right"
    format_line "Space   Clear hl    ,hs  Stage hunk    ,n   Line nums    "
    format_line "jk      Escape      ,hu  Undo hunk     ,ss  Strip space  "
    echo
    echo "    Text Manipulation   File Operations    FZF Tips           Misc"
    print_separator
    format_line "cs\"'    \" ‚Üí '       ,w   Save (force)  Ctrl+/  Preview    ,q   Quit"
    format_line "ds\"     Delete \"    ,Q   Quit all      Tab     Multi-sel  ,Q   Quit all"
    format_line "ysiw\"   Add \"       :w   Save          Enter   Open       u    Undo"
    format_line "gc      Comment     :q   Quit                             .    Repeat"
}

# Show tmux keybindings
show_tmux() {
    print_header "TMUX KEYBINDINGS (Prefix: Ctrl+a)"
    echo "    Panes               Windows            Sessions           Config"
    print_separator
    format_line "|    Split horiz    c    New           d    Detach       r    Reload"
    format_line "-    Split vert     1-9  Switch        s    List         ?    Show keys"
    format_line "x    Kill pane      n    Next          $    Rename       "
    format_line "X    Kill window    p    Previous      (    Previous     "
    echo
    echo "    Navigation (No Prefix)              Resizing (With Prefix)"
    print_separator
    format_line "Alt+E    Up         Alt+1-9  Window   Shift+‚Üë    Up 5    E    Up 5"
    format_line "Alt+S    Left                         Shift+‚Üê    Left 5  S    Left 5"
    format_line "Alt+D    Down                         Shift+‚Üì    Down 5  D    Down 5"
    format_line "Alt+F    Right                        Shift+‚Üí    Right 5 F    Right 5"
}

# Show git aliases
show_git() {
    print_header "GIT ALIASES"
    echo "    Status              Staging            Commits            Branches"
    print_separator
    format_line "gs   status         ga   add           gc   commit        gsw  switch"
    format_line "gl   log graph      gaa  add all       gcm  commit -m     gswc switch -c"
    format_line "gla  log all        gau  add -u        gca  amend         gb   branch"
    format_line "gd   diff           grs  restore       "
    format_line "gds  diff staged    grss restore --staged"
    echo
    echo "    Fetch               Push/Pull          Stash              Other"
    print_separator
    format_line "gf   fetch          gp   push          gst  stash         gcl  clone"
    format_line "gfo  fetch origin   gpl  pull          gstp stash pop     lg   lazygit"
    format_line "gfu  fetch upstream gpu  push -u       gsta stash apply   "
    format_line "gfa  fetch --all    "
    format_line "gfp  fetch --prune  "
    echo
    echo "    Functions                            Usage"
    print_separator
    format_line "gundo              Undo last commit (keep changes)"
    format_line "gquick \"message\"   Add all, commit, and push"
}

# Show shell shortcuts
show_shell() {
    print_header "SHELL ALIASES & SHORTCUTS"
    echo "    Navigation          File Operations    System Info        Network"
    print_separator
    format_line "..   Parent dir     ls   List (eza)    df   Disk free     myip    Public IP"
    format_line "...  Up 2 dirs      ll   Long list     du   Disk usage    localip Local IP"
    format_line "~    Home dir       la   All files     free Memory        ports   Open ports"
    format_line "-    Previous dir   tree Tree view     psg  Find process  note    Quick notes"
    echo
    echo "    Modern Tools        Archive            Dotfiles           FZF Extras"
    print_separator
    format_line "bat  Better cat     untar Extract      reload   Reload    fgb    Git branch"
    format_line "fd   Find files     tarc  Create tar   themes   List      fgl    Git log"
    format_line "rg   Ripgrep        fr    Find/replace theme-switch       frg    Ripgrep+fzf"
    format_line "vim  Neovim         extract Archive     update-configs    fp     Projects"
    echo
    echo "    Tmux Shortcuts      Safer Commands     Quick Actions      Claude"
    print_separator
    format_line "tm   New session    rmff Force remove  psmem  Sort by RAM   cl     New"
    format_line "ta   Attach         rmi  Interactive   pscpu  Sort by CPU   clc    Continue"
    format_line "tl   List sessions  cpv  Verbose copy  ducks  Large files   clp    Print"
    format_line "tk   Kill session   rmv  Verbose rm    md     View markdown cheat  Help"
}

# Show development tools
show_dev() {
    print_header "DEVELOPMENT SHORTCUTS"
    echo "    Python              Node.js            Docker             General"
    print_separator
    format_line "py   Python3        ni   npm install   dps  List          vimvim Real vim"
    format_line "venv Create venv    nr   npm run      di   Images        vivim  Real vi"
    format_line "activate Activate   nrd  npm run dev  dc   Compose       fr     Find/replace"
    format_line "pytest Run tests    nrb  npm run build dcu  Up           "
    format_line "fmt  Black format   nrt  npm run test  dcd  Down         "
    format_line "lint Ruff check     nclean Reinstall   dprune Clean       "
}

# Show all cheatsheets
show_all() {
    show_vim
    show_tmux
    show_git
    show_shell
    show_dev
}

# Build comprehensive searchable index of all shortcuts
# Format: category‚îÇshortcut‚îÇdescription‚îÇfull_command
build_shortcut_index() {
    cat <<'INDEX'
git‚îÇgs‚îÇgit status‚îÇgit status
git‚îÇgl‚îÇlog graph oneline‚îÇgit log --oneline --decorate --graph
git‚îÇgla‚îÇlog graph all branches‚îÇgit log --oneline --decorate --graph --all
git‚îÇga‚îÇadd files‚îÇgit add
git‚îÇgaa‚îÇadd all changes‚îÇgit add .
git‚îÇgau‚îÇadd updated files‚îÇgit add -u
git‚îÇgd‚îÇdiff unstaged‚îÇgit diff
git‚îÇgds‚îÇdiff staged‚îÇgit diff --staged
git‚îÇgrs‚îÇrestore working changes‚îÇgit restore
git‚îÇgrss‚îÇunstage files‚îÇgit restore --staged
git‚îÇgc‚îÇcommit‚îÇgit commit
git‚îÇgcm‚îÇcommit with message‚îÇgit commit -m
git‚îÇgca‚îÇamend commit‚îÇgit commit --amend
git‚îÇgsw‚îÇswitch branch‚îÇgit switch
git‚îÇgswc‚îÇswitch create branch‚îÇgit switch -c
git‚îÇgb‚îÇlist branches‚îÇgit branch
git‚îÇgf‚îÇfetch‚îÇgit fetch
git‚îÇgfo‚îÇfetch origin‚îÇgit fetch origin
git‚îÇgfu‚îÇfetch upstream‚îÇgit fetch upstream
git‚îÇgfa‚îÇfetch all remotes‚îÇgit fetch --all
git‚îÇgfp‚îÇfetch and prune‚îÇgit fetch --prune
git‚îÇgp‚îÇpush‚îÇgit push
git‚îÇgpl‚îÇpull‚îÇgit pull
git‚îÇgpu‚îÇpush set upstream‚îÇgit push -u origin HEAD
git‚îÇgst‚îÇstash changes‚îÇgit stash
git‚îÇgstp‚îÇstash pop‚îÇgit stash pop
git‚îÇgsta‚îÇstash apply‚îÇgit stash apply
git‚îÇgstl‚îÇstash list‚îÇgit stash list
git‚îÇgcl‚îÇclone repository‚îÇgit clone
git‚îÇlg‚îÇlazygit TUI‚îÇlazygit
git‚îÇgundo‚îÇundo last commit keep changes‚îÇgit reset HEAD~1 --soft
git‚îÇgquick‚îÇadd commit push in one command‚îÇgit add . && git commit -m "..." && git push
tmux‚îÇCtrl+a |‚îÇsplit window horizontal‚îÇprefix + |
tmux‚îÇCtrl+a -‚îÇsplit window vertical‚îÇprefix + -
tmux‚îÇCtrl+a x‚îÇkill pane‚îÇprefix + x
tmux‚îÇCtrl+a X‚îÇkill window‚îÇprefix + X
tmux‚îÇCtrl+a c‚îÇnew window‚îÇprefix + c
tmux‚îÇCtrl+a 1-9‚îÇswitch to window number‚îÇprefix + number
tmux‚îÇCtrl+a n‚îÇnext window‚îÇprefix + n
tmux‚îÇCtrl+a p‚îÇprevious window‚îÇprefix + p
tmux‚îÇCtrl+a d‚îÇdetach session‚îÇprefix + d
tmux‚îÇCtrl+a s‚îÇlist sessions‚îÇprefix + s
tmux‚îÇCtrl+a $‚îÇrename session‚îÇprefix + $
tmux‚îÇCtrl+a (‚îÇprevious session‚îÇprefix + (
tmux‚îÇCtrl+a )‚îÇnext session‚îÇprefix + )
tmux‚îÇCtrl+a r‚îÇreload config‚îÇprefix + r
tmux‚îÇCtrl+a ?‚îÇshow keybindings‚îÇprefix + ?
tmux‚îÇAlt+E‚îÇpane up no prefix‚îÇAlt+E (no prefix needed)
tmux‚îÇAlt+S‚îÇpane left no prefix‚îÇAlt+S (no prefix needed)
tmux‚îÇAlt+D‚îÇpane down no prefix‚îÇAlt+D (no prefix needed)
tmux‚îÇAlt+F‚îÇpane right no prefix‚îÇAlt+F (no prefix needed)
tmux‚îÇAlt+1-9‚îÇwindow number no prefix‚îÇAlt+number (no prefix needed)
tmux‚îÇCtrl+a E‚îÇresize pane up‚îÇprefix + E (5 lines)
tmux‚îÇCtrl+a S‚îÇresize pane left‚îÇprefix + S (5 lines)
tmux‚îÇCtrl+a D‚îÇresize pane down‚îÇprefix + D (5 lines)
tmux‚îÇCtrl+a F‚îÇresize pane right‚îÇprefix + F (5 lines)
vim‚îÇCtrl+P‚îÇfuzzy file search‚îÇCtrl+P
vim‚îÇ,f‚îÇfile browser‚îÇleader + f
vim‚îÇ,b‚îÇbuffer list‚îÇleader + b
vim‚îÇ,g‚îÇgrep search‚îÇleader + g
vim‚îÇSpace‚îÇclear highlight‚îÇSpace
vim‚îÇ,gs‚îÇgit status‚îÇleader + gs
vim‚îÇ,gd‚îÇgit diff‚îÇleader + gd
vim‚îÇ,gb‚îÇgit blame‚îÇleader + gb
vim‚îÇ,hn‚îÇnext git hunk‚îÇleader + hn
vim‚îÇ,hs‚îÇstage git hunk‚îÇleader + hs
vim‚îÇ,hu‚îÇundo git hunk‚îÇleader + hu
vim‚îÇ,af‚îÇautofix linting‚îÇleader + af
vim‚îÇ,an‚îÇnext error‚îÇleader + an
vim‚îÇ,ap‚îÇprevious error‚îÇleader + ap
vim‚îÇ,/‚îÇtoggle comment‚îÇleader + /
vim‚îÇ,n‚îÇtoggle line numbers‚îÇleader + n
vim‚îÇ,ss‚îÇstrip whitespace‚îÇleader + ss
vim‚îÇCtrl+E‚îÇwindow up‚îÇCtrl+E
vim‚îÇCtrl+S‚îÇwindow left‚îÇCtrl+S
vim‚îÇCtrl+D‚îÇwindow down‚îÇCtrl+D
vim‚îÇCtrl+F‚îÇwindow right‚îÇCtrl+F
vim‚îÇcs"'‚îÇchange surrounding quotes‚îÇcs"' (change " to ')
vim‚îÇds"‚îÇdelete surrounding quotes‚îÇds"
vim‚îÇysiw"‚îÇsurround word with quotes‚îÇysiw"
vim‚îÇgc‚îÇcomment motion‚îÇgc + motion
vim‚îÇ,w‚îÇsave force‚îÇleader + w
vim‚îÇ,Q‚îÇquit all‚îÇleader + Q
vim‚îÇ:w‚îÇsave‚îÇ:w
vim‚îÇ:q‚îÇquit‚îÇ:q
vim‚îÇ,q‚îÇquit‚îÇleader + q
vim‚îÇu‚îÇundo‚îÇu
vim‚îÇ.‚îÇrepeat last change‚îÇ.
shell‚îÇ..‚îÇparent directory‚îÇcd ..
shell‚îÇ...‚îÇup two directories‚îÇcd ../..
shell‚îÇ....‚îÇup three directories‚îÇcd ../../..
shell‚îÇ-‚îÇprevious directory‚îÇcd -
shell‚îÇls‚îÇlist files eza‚îÇeza --color=always --group-directories-first
shell‚îÇll‚îÇlong list‚îÇeza -l --time-style=long-iso
shell‚îÇla‚îÇlist all including hidden‚îÇeza -la
shell‚îÇl‚îÇcompact list‚îÇeza -CF
shell‚îÇtree‚îÇtree view‚îÇeza --tree
shell‚îÇbat‚îÇsyntax highlighted cat‚îÇbatcat
shell‚îÇview‚îÇview file with bat‚îÇbatcat
shell‚îÇfd‚îÇmodern find‚îÇfdfind
shell‚îÇdf‚îÇdisk free human readable‚îÇdf -h
shell‚îÇdu‚îÇdisk usage human readable‚îÇdu -h
shell‚îÇfree‚îÇmemory human readable‚îÇfree -h
shell‚îÇpsmem‚îÇprocesses by memory‚îÇps auxf | sort -nr -k 4
shell‚îÇpscpu‚îÇprocesses by cpu‚îÇps auxf | sort -nr -k 3
shell‚îÇports‚îÇlist open ports‚îÇnetstat -tulanp
shell‚îÇmyip‚îÇshow public IP‚îÇcurl ifconfig.me
shell‚îÇlocalip‚îÇshow local IP‚îÇhostname -I
shell‚îÇtm‚îÇnew tmux session‚îÇtmux new -s
shell‚îÇta‚îÇattach tmux session‚îÇtmux attach -t
shell‚îÇtl‚îÇlist tmux sessions‚îÇtmux list-sessions
shell‚îÇtk‚îÇkill tmux session‚îÇtmux kill-session -t
shell‚îÇuntar‚îÇextract tar.gz‚îÇtar -zxvf
shell‚îÇtarc‚îÇcreate tar.gz‚îÇtar -czf
shell‚îÇh‚îÇhistory‚îÇhistory
shell‚îÇhgrep‚îÇsearch history‚îÇhistory | grep
shell‚îÇrmff‚îÇforce recursive remove‚îÇrm -rf
shell‚îÇrmi‚îÇinteractive remove‚îÇrm -i
shell‚îÇcpv‚îÇverbose copy‚îÇcp -v
shell‚îÇrmv‚îÇverbose remove‚îÇrm -v
shell‚îÇcount‚îÇcount files‚îÇfind . -type f | wc -l
shell‚îÇreload‚îÇreload shell config‚îÇsource ~/.zshrc or ~/.bashrc
shell‚îÇthemes‚îÇlist available themes‚îÇls configs/themes/
shell‚îÇtheme-switch‚îÇinteractive theme switcher‚îÇ$DOTFILES_DIR/bin/theme-switcher
shell‚îÇupdate-configs‚îÇupdate dotfiles configs‚îÇ$DOTFILES_DIR/bin/update-configs
shell‚îÇfr‚îÇfind and replace‚îÇ$DOTFILES_DIR/bin/fr
shell‚îÇcheat‚îÇthis cheatsheet‚îÇ$DOTFILES_DIR/bin/cheatsheet
shell‚îÇcl‚îÇnew claude session‚îÇclaude
shell‚îÇclc‚îÇcontinue claude session‚îÇclaude --continue
shell‚îÇclp‚îÇclaude one-off command‚îÇclaude --print
shell‚îÇfgb‚îÇfzf git branch switcher‚îÇFZF git branch selector
shell‚îÇfgl‚îÇfzf git log browser‚îÇFZF git log browser
shell‚îÇfrg‚îÇfzf ripgrep search‚îÇFZF + ripgrep content search
shell‚îÇfp‚îÇfzf project finder‚îÇFZF project directory finder
shell‚îÇmd‚îÇview markdown‚îÇbat --style=plain --language=markdown
docker‚îÇdps‚îÇlist running containers‚îÇdocker ps
docker‚îÇdpsa‚îÇlist all containers‚îÇdocker ps -a
docker‚îÇdexec‚îÇexec into container‚îÇdocker exec -it
docker‚îÇdlogs‚îÇfollow container logs‚îÇdocker logs -f
docker‚îÇdstop‚îÇstop container‚îÇdocker stop
docker‚îÇdrm‚îÇremove container‚îÇdocker rm
docker‚îÇdrmf‚îÇforce remove container‚îÇdocker rm -f
docker‚îÇdi‚îÇlist images‚îÇdocker images
docker‚îÇdpull‚îÇpull image‚îÇdocker pull
docker‚îÇdbuild‚îÇbuild image with tag‚îÇdocker build -t
docker‚îÇdrmi‚îÇremove image‚îÇdocker rmi
docker‚îÇdc‚îÇdocker compose command‚îÇdocker compose
docker‚îÇdcu‚îÇcompose up detached‚îÇdocker compose up -d
docker‚îÇdcd‚îÇcompose down‚îÇdocker compose down
docker‚îÇdcl‚îÇcompose logs follow‚îÇdocker compose logs -f
docker‚îÇdcr‚îÇcompose restart‚îÇdocker compose restart
docker‚îÇdcb‚îÇcompose build‚îÇdocker compose build
docker‚îÇdprune‚îÇprune unused resources‚îÇdocker system prune
docker‚îÇdprunea‚îÇprune all unused‚îÇdocker system prune -a
docker‚îÇdenter‚îÇenter container bash‚îÇdocker exec -it <container> /bin/bash
docker‚îÇdclean‚îÇclean everything‚îÇdocker system prune -af --volumes
docker‚îÇdrun‚îÇquick run remove‚îÇdocker run -it --rm
docker‚îÇdstopall‚îÇstop all containers‚îÇdocker stop $(docker ps -q)
python‚îÇvenv‚îÇcreate virtual env‚îÇpython3 -m venv venv
python‚îÇactivate‚îÇactivate venv‚îÇsource venv/bin/activate
python‚îÇpipreqs‚îÇinstall requirements‚îÇpip install -r requirements.txt
python‚îÇpy‚îÇpython3 shortcut‚îÇpython3
python‚îÇipy‚îÇipython shell‚îÇipython
python‚îÇpytest‚îÇrun pytest‚îÇpython -m pytest
python‚îÇpyt‚îÇpytest verbose‚îÇpython -m pytest -v
python‚îÇfmt‚îÇformat with black‚îÇblack .
python‚îÇlint‚îÇlint with ruff‚îÇruff check .
python‚îÇlintf‚îÇlint and fix‚îÇruff check . --fix
python‚îÇpyserver‚îÇquick http server‚îÇpython -m http.server
node‚îÇni‚îÇnpm install‚îÇnpm install
node‚îÇnr‚îÇnpm run‚îÇnpm run
node‚îÇnrm‚îÇremove node_modules‚îÇrm -rf node_modules package-lock.json
node‚îÇnrd‚îÇnpm run dev‚îÇnpm run dev
node‚îÇnrb‚îÇnpm run build‚îÇnpm run build
node‚îÇnrt‚îÇnpm run test‚îÇnpm run test
node‚îÇnrs‚îÇnpm run start‚îÇnpm run start
node‚îÇnclean‚îÇclean reinstall‚îÇrm -rf node_modules && npm install
vscode‚îÇc‚îÇopen vscode here‚îÇcode .
vscode‚îÇcz‚îÇedit zshrc‚îÇcode ~/.zshrc
vscode‚îÇcb‚îÇedit bashrc‚îÇcode ~/.bashrc
vscode‚îÇcdot‚îÇopen dotfiles‚îÇcode $DOTFILES_DIR
vscode‚îÇctodo‚îÇopen todos‚îÇcode $DOTFILES_DIR/_artifacts/issues/
vscode‚îÇcw‚îÇopen with work profile‚îÇcode . --profile "Work"
vscode‚îÇcp‚îÇopen with personal profile‚îÇcode . --profile "Personal"
vscode‚îÇgdvc‚îÇview staged in vscode‚îÇgit diff --cached | code -
vscode‚îÇgdiff‚îÇview diff in vscode‚îÇgit diff | code -
vscode‚îÇcsettings‚îÇedit vscode settings‚îÇcode ~/.config/Code/User/settings.json
vscode‚îÇckeys‚îÇedit vscode keys‚îÇcode ~/.config/Code/User/keybindings.json
vscode‚îÇcws‚îÇopen workspace file‚îÇcode *.code-workspace
vscode‚îÇcproj‚îÇfzf project opener‚îÇFZF project finder + open in VSCode
vscode‚îÇcf‚îÇfzf file opener‚îÇFZF file finder + open in VSCode
vscode‚îÇcgrep‚îÇfzf ripgrep opener‚îÇRipgrep search + open at line in VSCode
vscode‚îÇcdiff‚îÇdiff two files‚îÇcode --diff file1 file2
wsl‚îÇcdwin‚îÇcd windows home‚îÇcd $WIN_HOME
wsl‚îÇcddesk‚îÇcd windows desktop‚îÇcd $WIN_DESKTOP
wsl‚îÇcddl‚îÇcd windows downloads‚îÇcd $WIN_DOWNLOADS
wsl‚îÇcddocs‚îÇcd windows documents‚îÇcd $WIN_DOCUMENTS
wsl‚îÇnotepad‚îÇwindows notepad‚îÇnotepad.exe
wsl‚îÇclip‚îÇwindows clipboard‚îÇclip.exe
wsl‚îÇpwsh‚îÇpowershell‚îÇpowershell.exe
wsl‚îÇcmd‚îÇwindows cmd‚îÇcmd.exe
wsl‚îÇexplorer‚îÇopen windows explorer‚îÇexplorer.exe
wsl‚îÇopen‚îÇopen windows explorer‚îÇexplorer.exe
wsl‚îÇcwd‚îÇcopy pwd to clipboard‚îÇpwd | clip.exe
wsl‚îÇwcd‚îÇcopy windows path‚îÇwslpath -w $(pwd) | clip.exe
wsl‚îÇwpath‚îÇconvert to windows path‚îÇwslpath -w
wsl‚îÇlpath‚îÇconvert to linux path‚îÇwslpath -u
wsl‚îÇwin-ssh‚îÇlist windows ssh keys‚îÇls -la $WIN_SSH
wsl‚îÇsync-ssh‚îÇimport windows ssh keys‚îÇimport_windows_ssh_keys
INDEX
}

# Show detailed information about a specific shortcut
show_shortcut_detail() {
    local category="$1"
    local shortcut="$2"

    # Get the full line from the index
    local detail=$(build_shortcut_index | grep "^${category}‚îÇ${shortcut}‚îÇ")

    if [[ -n "$detail" ]]; then
        local desc=$(echo "$detail" | cut -d'‚îÇ' -f3)
        local cmd=$(echo "$detail" | cut -d'‚îÇ' -f4)

        echo ""
        echo "${BOLD}${YELLOW}${shortcut}${RESET}"
        echo "${DIM}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
        echo "${CYAN}Category:${RESET}    ${category}"
        echo "${CYAN}Usage:${RESET}       ${desc}"
        echo "${CYAN}Command:${RESET}     ${cmd}"
        echo ""

        # Add context-specific tips
        case "$category" in
            git)
                echo "${DIM}üí° Tip: Type 'cheat git' for all git shortcuts${RESET}"
                ;;
            tmux)
                echo "${DIM}üí° Tip: Prefix is Ctrl+a (change with TMUX_PREFIX)${RESET}"
                ;;
            vim)
                echo "${DIM}üí° Tip: Leader key is comma (,)${RESET}"
                ;;
        esac
    else
        echo ""
        echo "${DIM}No details available${RESET}"
        echo ""
    fi
}

# Export function for FZF preview
export -f show_shortcut_detail
export -f build_shortcut_index

# Interactive FZF selector with searchable shortcuts
show_interactive() {
    # Fallback to traditional view if FZF not available
    if ! command -v fzf >/dev/null 2>&1; then
        show_all | less -R
        return
    fi

    # Color definitions for preview
    if command -v tput >/dev/null 2>&1; then
        local PREVIEW_BOLD=$(tput bold)
        local PREVIEW_CYAN=$(tput setaf 6)
        local PREVIEW_YELLOW=$(tput setaf 3)
        local PREVIEW_DIM=$(tput dim)
        local PREVIEW_RESET=$(tput sgr0)
    else
        local PREVIEW_BOLD=""
        local PREVIEW_CYAN=""
        local PREVIEW_YELLOW=""
        local PREVIEW_DIM=""
        local PREVIEW_RESET=""
    fi

    # Create temporary file for preview script
    local preview_script=$(mktemp)
    cat > "$preview_script" <<PREVIEW_EOF
#!/bin/bash
# Self-contained preview script
BOLD="$PREVIEW_BOLD"
CYAN="$PREVIEW_CYAN"
YELLOW="$PREVIEW_YELLOW"
DIM="$PREVIEW_DIM"
RESET="$PREVIEW_RESET"

# Extract from formatted line
line="\$1"
category=\$(echo "\$line" | awk '{print \$1}')
shortcut=\$(echo "\$line" | awk '{print \$2}')
desc=\$(echo "\$line" | awk '{for(i=3;i<=NF-1;i++) if (\$i != "") {for(j=i;j<=NF-1;j++) printf "%s ", \$j; break}}' | sed 's/[[:space:]]*\$//')
cmd=\$(echo "\$line" | awk '{print \$NF}')

# Build the index inline and find the full entry
index_line=\$(cat "$0" | sed -n '/^build_shortcut_index()/,/^}/p' | grep "^\${category}‚îÇ\${shortcut}‚îÇ")

if [[ -n "\$index_line" ]]; then
    full_desc=\$(echo "\$index_line" | cut -d'‚îÇ' -f3)
    full_cmd=\$(echo "\$index_line" | cut -d'‚îÇ' -f4)

    echo ""
    echo "\${BOLD}\${YELLOW}\${shortcut}\${RESET}"
    echo "\${DIM}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\${RESET}"
    echo "\${CYAN}Category:\${RESET}    \${category}"
    echo "\${CYAN}Usage:\${RESET}       \${full_desc}"
    echo "\${CYAN}Command:\${RESET}     \${full_cmd}"
    echo ""

    case "\$category" in
        git)
            echo "\${DIM}üí° Tip: Type 'cheat git' for all git shortcuts\${RESET}"
            ;;
        tmux)
            echo "\${DIM}üí° Tip: Prefix is Ctrl+a\${RESET}"
            ;;
        vim)
            echo "\${DIM}üí° Tip: Leader key is comma (,)\${RESET}"
            ;;
    esac
else
    echo ""
    echo "\${DIM}No details available\${RESET}"
    echo ""
fi
PREVIEW_EOF
    chmod +x "$preview_script"

    # Build searchable index, format for display, and let user select
    local selected=$(build_shortcut_index | \
        awk -F'‚îÇ' '{printf "%-10s %-15s %-40s %s\n", $1, $2, $3, $4}' | \
        fzf --ansi \
            --prompt='üîç Search shortcuts > ' \
            --header='Type: shortcut name, description, or category | Enter: Copy command | Esc: Cancel' \
            --preview="$preview_script {}" \
            --preview-window='top:10:wrap:rounded:border-rounded' \
            --height=100% \
            --border=rounded \
            --color='header:italic:cyan,prompt:bold:yellow')

    # Clean up preview script
    rm -f "$preview_script"

    # If user selected something, extract and display the actual command
    if [[ -n "$selected" ]]; then
        local command=$(echo "$selected" | awk '{print $NF}')
        echo ""
        echo "${BOLD}${CYAN}Command:${RESET} ${YELLOW}${command}${RESET}"
        echo ""
        echo "${DIM}üí° Tip: Use Ctrl+Shift+C to copy from terminal${RESET}"
        echo ""
    fi
}

# Main function
main() {
    case "${1}" in
        vim)
            show_vim
            ;;
        tmux)
            show_tmux
            ;;
        git)
            show_git
            ;;
        shell)
            show_shell
            ;;
        dev)
            show_dev
            ;;
        all)
            show_all
            ;;
        "")
            # No args - show interactive selector
            show_interactive
            ;;
        *)
            echo "Usage: cheat [vim|tmux|git|shell|dev|all]"
            echo "Show keybindings and shortcuts for dotfiles tools"
            echo ""
            echo "Run 'cheat' with no arguments for interactive mode"
            exit 1
            ;;
    esac
}

# Handle piping to less for long output when showing specific sections
if [[ -t 1 ]] && [[ -n "$1" ]] && [[ "$1" != "all" ]]; then
    # Direct access to specific section - show in less
    main "$@" | less -R
elif [[ -t 1 ]] && [[ "$1" == "all" ]]; then
    # Direct access to all sections - show in less
    main "$@" | less -R
elif [[ -t 1 ]] && [[ -z "$1" ]]; then
    # No args - interactive mode handles its own display
    main "$@"
else
    # Output is piped
    main "$@"
fi